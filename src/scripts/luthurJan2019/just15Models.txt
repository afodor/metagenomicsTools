
rm(list=ls())

setwd("C:\\Users\\afodor\\git\\giardia_murine_fmt\\data")


levels<- c("kingdom",  "phylum" , "class" , "order" , "family", "genus" )

library("vegan")

for( taxa in levels) 
{
	inFile <- paste0( "pcoa_", taxa, "Log10NormMetadataallData.txt")
	myT <- read.table(inFile, sep="\t", header=TRUE, row.names=1)

	# 15 only 
	myT <- myT[ myT$experiment=="GMN15",]
	
	pValuesDiet <- vector()
	pValuesChallenge <- vector()
	pValuesInteraction <- vector()
	names <- vector()
	index <- 1
	
	startPos <- which(names(myT)=="shannonDiveristy")
	endPos <- which(names(myT)=="MDS5")
	
	for( i in (startPos:endPos) ) 
	{
		yData <- myT[,i]
		
		if( sum( yData != 0) > nrow(myT) /10 ) 
		{
			aLm <- lm( yData ~ myT$diet * myT$challenge )
			names[index] <- names(myT)[i]
			pValuesDiet[index] <- summary(aLm)$coefficients[2,4]
			pValuesChallenge[index] <- summary(aLm)$coefficients[3,4]
			pValuesInteraction[index] <- summary(aLm)$coefficients[4,4]
			index <- index + 1
		}
	}
	
	dFrame <- data.frame( names,pValuesDiet,pValuesChallenge, pValuesInteraction)
	dFrame <- dFrame [order(dFrame$pValuesDiet),]
	
	dFrame$adjustedPDiet <- p.adjust( dFrame$pValuesDiet, method = "BH" )	
	dFrame$adjustedPChallenge <- p.adjust( dFrame$pValuesChallenge, method = "BH" )	
	dFrame$adjustedPInteraction <- p.adjust( dFrame$pValuesInteraction, method = "BH" )	
	
	write.table(dFrame, file=paste("pValuesForTaxa_", taxa, ".txt",sep=""), sep="\t",row.names=FALSE)
}

