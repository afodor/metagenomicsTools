rm(list=ls())

setwd("C:\\DaisyQunitles")

getQuintileGroup <- function( val, quintile )
{
	for( i in 1:4)
	{
		if( val >= as.numeric(quintile[i]) & val <= as.numeric(quintile[i+1]) ) 
			return (i) 
	}

	return (5)
	
}



myT <- read.table("genuspivotedLogNormPlusMetaMDS.txt", sep="\t", header=TRUE)

myT <- myT[  !is.na(myT$percentChangeBLTwelveWeight),]

quintile <- quantile(myT$percentChangeBLTwelveWeight, probs=c(0,.2,.4,.6,.8,1))

qunitAssignments <- vector()

for( i in 1:nrow(myT)) 
{
	qunitAssignments[i] = getQuintileGroup(  myT$percentChangeBLTwelveWeight[i], quintile ) 
}

pValues <-vector()
qintForPValue <- vector()
taxaNames <- vector()
index <- 1

for( i in 20:ncol(myT))
{
	if( sum(myT[,i] != 0 ) > nrow(myT) / 10 )
	{
		for( j in 1:5 )
		{
			myLm <- lm(  myT[ qunitAssignments == j  ,i] ~ myT$timepoint[qunitAssignments == j  ])
			pValues[index] = anova(myLm)$"Pr(>F)"[1]
			qintForPValue[index] = j
			taxaNames[index] = names(myT)[i]
			index = index + 1	
		}
	}
}
	
pdf("histograms.pdf")
par(mfrow=c(3,2))

for( j in 1:5 ) 
{
	hist(pValues[qintForPValue==j], main=paste("Quintile=",j) )		
}

boxplot(  myT$percentChangeBLTwelveWeight[qunitAssignments == 1], 
			myT$percentChangeBLTwelveWeight[qunitAssignments == 2],
				myT$percentChangeBLTwelveWeight[qunitAssignments == 3],
					myT$percentChangeBLTwelveWeight[qunitAssignments == 4],
						myT$percentChangeBLTwelveWeight[qunitAssignments == 5],xlab="quintile", ylab="Percent Change BL TwelveWeight")
					

for( i in 20:ncol(myT))
{
	for( j in 1:5)
	{
		myText = paste("pvalue " ,pValues[i-19,j][[1]][1] , names(myT)[i])
		plot( myT[ qunitAssignments == j  ,i] ~ myT$timepoint[qunitAssignments == j  ] ,main=myText) 	
	}
	
	plot.new()		
}

dev.off()
		
}

